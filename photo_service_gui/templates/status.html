{% extends "open_base_new.html" %}
{% block titleheader %}{{ lopsinfo }}{% endblock %}

{% block headercontainer %}{{ lopsinfo }} <img id=header_icon src="../static/icon_timing.png"> {% endblock %}

{% block refresh %}{% endblock %}
{% block titlemain %}
  <img id=menu_icon src="../static/icon_timing.png"> {{ lopsinfo }}
{% endblock %}
{% block menuitems %}
  <li class=dropdown id=topborder>
    <a href=javascript:void(0) class=dropbtn>Velg funksjon</a>
    <div class=dropdown-content>
      <a href=status?event_id={{ event_id }}>Vis alle</a>
      <a href=status?event_id={{ event_id }}&filter=integration_status>Integration service</a>
      <a href=status?event_id={{ event_id }}&filter=video_status_CAPTURE>Video service (CAPTURE)</a>
      <a href=status?event_id={{ event_id }}&filter=video_status_DETECT>Video service (DETECT)</a>
      <a href=status?event_id={{ event_id }}&filter={{ filter }}&action=delete_select>Sletting</a>
    </div>
  </li>
{% endblock %}
{% block tips %}
    Det er mulig å slette status - både enkeltvis og alle. Merk at det bare er link til bildene som slettes.
{% endblock %}

{% block content %}
<! --- Edit menu --->

    {% if action in ["delete_select"] %}
      <div id="spacer"></div>
      <section class="row" aria-label="Bilder">
        <div class="col-sm-12">
          <div class="status-card" role="status" aria-live="polite">
            <form action=/status method=post>
              <button id="toggleAll" type="button" class="btn btn-default">Velg alle</button>
              <button type="submit" name={{ action }} value="  Slett valgte " class="btn btn-warning">Slett valgte</button>
              <button type="submit" name=delete_all value="  Slett alle " class="btn btn-warning">Slett alle</button>
              <input type="hidden" name="event_id" value="{{ event_id }}">
              <input type="hidden" name=action value={{ action }}>
            <script>
              // Toggle all checkboxes
              const toggleBtn = document.getElementById('toggleAll');
              toggleBtn.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent any default button behavior
                const itemsList = document.querySelectorAll('input.item-chk[type="checkbox"]');
                const anyUnchecked = Array.from(itemsList).some(cb => !cb.checked);
                itemsList.forEach(cb => cb.checked = anyUnchecked);
              });
            </script>
          </div>
        </div>
      </section>
    {% endif %}
    <div id="spacer"></div>

    <section class="row" aria-label="Status">
        <div class="col-sm-12">
            <div class="status-card" role="status" aria-live="polite">
                {% for status_message in status %}
                    {% if action in ["delete_select"] %}
                        <input type="checkbox" class="item-chk" name="delete_status_{{ loop.index }}" value="{{ status_message.id }}">
                    {% endif %}
                    <b>{{ status_message.time }}</b>
                    {% if status_message.type == "integration_status" %}<img id=menu_icon src="../static/upload.png" title="{{ status_message.type }}">
                    {% elif status_message.type in ["video_status_CAPTURE_SRT", "video_status_CAPTURE_LOCAL"] %}<img id=menu_icon src="../static/capture.png" title="{{ status_message.type }}">
                    {% elif status_message.type == "video_status_DETECT" %}<img id=menu_icon src="../static/detect.png" title="{{ status_message.type }}">
                    {% endif %}
                    {% if "Error" in status_message.message %}
                        <span id=red>{{ status_message.message }}</span>
                    {% else %}
                        {{ status_message.message }}
                    {% endif %}
                    {% if status_message.details %}
                      <details style="display: inline;">
                          <summary style="display: inline; list-style: none; color: #0066cc; text-decoration: underline; cursor: pointer;">(detaljer)</summary>
                          <pre style="margin: 5px 0; padding: 8px; background: #f5f5f5; border-left: 3px solid #ccc; font-size: 0.9em; white-space: pre-wrap;">{{ status_message.details | tojson(indent=2) }}</pre>
                      </details>
                    {% else %}
                      <br>
                    {% endif %}
                {% endfor %}
          </div>
        </div>
      {% if action in ["delete_select"] %}
        </form>
      {% endif %}
    </section>
{% endblock %}