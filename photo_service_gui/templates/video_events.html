{% extends "open_base.html" %}
{% block titlecontainer %}
<div class="w3-10"></div>
<div class="w3-80">
{% endblock %}

{% block titleheader %}
  Video events
{% endblock %}

{% block headercontainer %}Video events <img id=header_icon src="../static/icon_photos.png"> {% endblock %}

{% block titlemain %}
  <img id=menu_icon src="../static/icon_photos.png"> Video events
{% endblock %}

{% block menuitems %}{% endblock %}

{% block content %}
  <script>
    /* this function will send events to queue without reloading the page */
    function pub_events_new(button) {
      try {
        var button_text = document.getElementById(button.id).innerHTML;
        document.getElementById(button.id).innerHTML = " Sender... ";
        document.getElementById(button.id).disabled = true;
        var max_lengt_info = 600;
        var old_info = document.getElementById("send_result").innerHTML;
        if (old_info.length > max_lengt_info) {
          old_info = old_info.substring(0, max_lengt_info);
        }

        // get current time, hours, minutes
        var d = new Date();
        var current_time = d.toLocaleTimeString();

        var action = "pub";
        if (button.id == "pub_from_file_button") {
          action = "pub_from_file";
        }

        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "/pub_events", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

        var formData ="action=" + action + "&event_id={{ event_id }}"

        xhttp.send(formData);
        xhttp.onload = function() {
          try {
            // load new info
            const info = this.response;
            document.getElementById("send_result").innerHTML = current_time + " - " + info + "<br>" + old_info;
            document.getElementById(button.id).innerHTML = button_text;
            document.getElementById(button.id).disabled = false;
          }
          catch(err) {
            if (err.message.indexOf("401") > 0) {
              alert("Error 401 - Logg inn p√• nytt.");
            }
            else {
              document.getElementById("send_result").innerHTML = err;
              alert(err);
            }
            document.getElementById(button.id).innerHTML = button_text;
            document.getElementById(button.id).disabled = false;
          }
        }
      }
      catch(err) {
          alert(err);
          document.getElementById(button.id).innerHTML = button_text;
          document.getElementById(button.id).disabled = false;
        }
        return false; // avoid to execute the actual submit of the form.
      }
  </script>

  <table>
      <tr>
        <td align=center>
          <button type="button" id="pub_events_button" onclick="pub_events_new(this);" > Send nye bilder fra video-analyse </button>
          <br>
          <button type="button" name="file_data" id="pub_from_file_button" onclick="pub_events_new(this);" > Test: Send data fra fil </button>
        </td>
    </tr>
    <tr height="500">
      <td id="orange" valign="top">
        <span id="send_result"></span>
      </td>
      <td id="orange" valign="top">
        <span id="analyse_result"></span>
      </td>
  </tr>
</table>
{% endblock %}
</div>
