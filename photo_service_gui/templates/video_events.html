{% extends "open_base.html" %}
{% block titlecontainer %}
<div class="w3-80">
{% endblock %}

{% block titleheader %}
  Video events
{% endblock %}

{% block headercontainer %}Video events <img id=header_icon src="../static/icon_photos.png"> {% endblock %}

{% block titlemain %}
  <img id=menu_icon src="../static/icon_photos.png"> Video events
{% endblock %}

{% block menuitems %}{% endblock %}

{% block content %}
  <script>

    /* this function will sync (update+get) status updates with backend */
    function sync_status() {
      try {
        var formData = "video_status=true&event_id={{ event_id }}"
        var checkBoxPub = document.getElementById("pub_events_automatic");
        if (checkBoxPub.checked) {
          formData = formData + "&pub_message=true"
        }
        var checkBoxAna = document.getElementById("video_analytics_automatic");
        if (checkBoxAna.checked) {
          formData = formData + "&video_analytics_start=true"
        }
        else {
          formData = formData + "&video_analytics_stop=true"
        }
        
        loadDoc("POST", "/video_events", mySync, formData);

        function mySync(xhttp) {
          try {
            // load new info
            const info = xhttp.response;
            document.getElementById("send_result").innerHTML = info;
          }
          catch(err) {
              alert(err);
          }
        }
      }
      catch(err) {
          alert(err);
      }
    }

    /* this function will get status updates */
    function loadDoc(req, url, cFunction, formData) {
      const xhttp = new XMLHttpRequest();
      xhttp.onload = function() {cFunction(this);}
      xhttp.open(req, url, true);
      xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhttp.send(formData);
    }
  </script>

  <table>
    <tr id="headerblack">
      <td>Service status</td>
      <td>Line crossing configuration</td>
    </tr>
    <tr height="500">
      <td valign="top">
        <table> 
        <tr>  
          <td>
            Run video analytics
            <input type="checkbox" id="video_analytics_automatic" name="video_analytics_checkbox" value="video_analytics_checkbox" {% if video_analytics_running == "true" %} checked {% endif %}>
          </td>
          <td>
            Run Pubsub (send photos)
            <input type="checkbox" id="pub_events_automatic" name="pub_events_checkbox" value="pub_events_checkbox">
          </td>
        </tr>
      </table>
        <span id="send_result"></span>
      </td>
      <td valign="top">
        <form action=/video_events method=post>
          <input type="hidden" name="event_id" value="{{ event_id }}">
          <table> 
            <tr>
              <td>Trigger line config</td>
              <td><input type="text" id="trigger_line_xyxyn" name="trigger_line_xyxyn" value="{{ trigger_line_xyxyn }}"> (eks: 0.1:0.8:0.9:0.8)</td>
            </tr>
            <tr>
              <td>Video url</td>
              <td><input type="text" id="video_url" name="video_url" value="{{ video_url }}" size="50"></td>
            </tr>
            <tr>
              <td></td>
              <td><input type="submit" name="update_config" value="  Lagre  "></td>
            </tr>
          </table>
        </form>
        <br>
        <!-- Trigger the Modal -->
        <img id="modalImg_line" src="{{ line_config_file }}" alt="Click to view big size" style="width:400px">
        <!-- The Modal -->
        <div id="myModal_line" class="modal">
          <!-- The Close Button -->
          <span id="close_line" class="close">&times;</span>
          <!-- Modal Content (The Image) -->
          <img class="modal-content" id="img_line">
          <!-- Modal Caption (Image Text) -->
          <div id="caption_line"></div>
        </div>
        <script>
          // Get the modal
          var modal_line = document.getElementById("myModal_line");
          
          // Get the image and insert it inside the modal - use its "alt" text as a caption
          var img_line = document.getElementById("modalImg_line");
          var modalImg_line = document.getElementById("img_line");
          var captionText_line = document.getElementById("caption_line");
          img_line.onclick = function(){
            modal_line.style.display = "block";
            modalImg_line.src = this.src;
            captionText_line.innerHTML = this.alt;
          }
          
          // Get the <span> element that closes the modal
          var span_line = document.getElementById("close_line");
          
          // When the user clicks on <span> (x), close the modal
          span_line.onclick = function() { 
            modal_line.style.display = "none";
          }
          </script>
        
      </td>
    </tr>
</table>
<script>
  // trigger every 5 seconds
  window.setInterval(sync_status, 5000);

</script>
{% endblock %}
</div>